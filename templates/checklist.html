<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checklist Group {{ number }}</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f4f9; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* Header */
        .header { display: flex; justify-content: space-between; align-tasks: center; margin-bottom: 20px; }
        .back-link { text-decoration: none; color: #007bff; font-weight: bold; }
        .last-check { font-size: 0.9rem; color: #666; }

        /* Zones (Cards) */
        .zone-card { background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 25px; overflow: hidden; }
        .zone-header { background-color: #eee; padding: 15px 20px; border-bottom: 1px solid #ddd; }
        .zone-header h2 { margin: 0; font-size: 1.2rem; }

       
        
        /* Default Task styling */
        .task-details { flex-grow: 1; }
        .task-name { font-size: 1.05rem; display: block; }

        /* 1. Reset the default list style */
        ul.tasks {
            list-style: none; /* Remove default black dots */
            padding-left: 0;
        }

        /* 2. Base style for the task card */
        .task-card {
            position: relative;
            padding: 10px 10px 10px 35px; /* Add left padding to make room for the bullet */
            margin-bottom: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* 3. Create the Custom Bullet (The pseudo-element) */
        .task-card::before {
            content: '';
            position: absolute;
            left: 10px;  /* Position it inside the padding we created */
            top: 50%;
            transform: translateY(-50%); /* Center it vertically */
            width: 20px;
            height: 20px;
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            
            /* DEFAULT BULLET: A gray empty circle */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3C/svg%3E");
        }

        /* 4. The 'Done' State (Green Circle with White Check) */
        .task-done::before {
            /* OVERRIDE BULLET: Filled green circle with white checkmark */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none'%3E%3Ccircle cx='12' cy='12' r='10' fill='%2328a745'/%3E%3Cpath d='M8 12l3 3 7-7' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        }

        /* Optional: Slight styling change for the card background if done */
        .task-done {
            background-color: #f0fff4; /* Very light green background */
            border-color: #c3e6cb;
        }

        /* Footer Stats */
        .stats-footer { background: #333; color: white; padding: 15px; border-radius: 8px; display: flex; justify-content: space-around; margin-top: 20px; }
        .stat-box { text-align: center; }
        .stat-val { font-size: 1.5rem; font-weight: bold; }
        .stat-label { font-size: 0.8rem; opacity: 0.7; }

        /* Done tasks */

        #form-tasks.hide-done .task-done{ display: none; }

        .task-done .task-name{ text-decoration: line-through; color: #aaa; }

        .health-bar {
            width: 100%;
            height: 20px;
            background: #1e1e1e;
            border: 2px solid #444;
            border-radius: 999px;
            overflow: hidden;
            --p: 0;
        }

        .bar__fill {
            height: 100%;
            width: calc(var(--p) * 100%);
            background: linear-gradient(
              90deg,
              #2ecc71 0%,
              #f1c40f 60%,
              #e74c3c 100%
            );
            transition: width 200ms ease;
        }
    </style>
</head>
<body>
<script>
    function hideDone() {
        document.getElementById('form-tasks').classList.toggle("hide-done");
    }
    function setHealth(percent, element) {
        const clamped = Math.max(0, Math.min(1, percent));
        element.style.setProperty("--p", clamped);
    }
</script>
<div class="container">


    <h1>Group {{ number }} Inspection</h1>

    {% if data %}

        <div class="header">
            <a href="/" class="back-link">‚Üê Back to Dashboard</a>
            <div class="last-check">Last Check: {{ data.last_check }}</div>
            <div>
                <button class="task-hide-button" onclick="hideDone()">Hide OK</button>
            </div>
        </div>


        <form id="form-tasks">
            {% for zone in data.zones %}
            <div class="zone-card">
                <div class="zone-header">
                    <h2>{{ zone.title }}</h2>
                    <div class="health-bar">
                        <div class="bar__fill"></div>
                    </div>
                </div>
                <ul class="tasks">
                {% for task in zone.tasks %}
                    <li class="task-card {% if task.status == 'OK' %}task-done{% elif task.status == 'Pending' %}task-pending{% endif %}">
                        <span class="task-name">{{ task.tarea }}</span>
                    </li>
                {% endfor %}
                </ul>
            </div>
            {% endfor %}
        </form>

    {% else %}
        <p style="color:red; text-align:center;">Error loading Script data.</p>
    {% endif %}

    {% if demo %}
        <form id="demo-done">
            <div class="zone-card">
                <div class="zone-header">   
                    <h2>Demostracions Realitzades</h2>
                </div>
                    <ul class="tasks">
                      {% for pdemo in demo.done_demos %}
                                <li class="task-card task-done">
                                    <span class="task-name">{{ pdemo }}</span>
                                </li>
                      {% endfor %}
                    </ul>
            </div>
        </form>
        <form id="demo-pending">            
            <div class="zone-card">
                <div class="zone-header">   
                    <h2>Demostracions Pendents</h2>
                </div>
                <ul class="tasks">
                  {% for ddemo in demo.pending_demos %}
                            <li class="task-card task-pending">
                                <span class="task-name">{{ ddemo }}</span>
                            </li>
                  {% endfor %}
                </ul>
            </div>
        </form>
    {% else %}
        <p style="color:red; text-align:center;">Error loading Demostration data.</p>
    {% endif %}



</div>
<script>
    function setHealthBar(){
        zcards=document.querySelectorAll(".zone-card")
        for (let tz of zcards) {
            header = tz.querySelector(".health-bar")
            nt = tz.querySelectorAll("li.task-card").length
            ndt = tz.querySelectorAll("li.task-card.task-done").length
            console.log(header.innerText)
            console.log(ndt/nt)
            setHealth(ndt/nt, header.querySelector(".healthbar"))
        }
    }
    setHealthBar()
</script>
</body>
</html>
